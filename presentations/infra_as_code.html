<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Ansible</title>
<meta name="author" content="(Jb Doyon)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/css/reveal.css"/>

<link rel="stylesheet" href="http://cdn.jsdelivr.net/reveal.js/3.0.0/css/theme/blood.css" id="theme"/>


<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'http://cdn.jsdelivr.net/reveal.js/3.0.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Ansible</h1><h2 class="author">Jb Doyon</h2><p class="date">Created: 2017-09-08 Fri 12:17</p>
</section>
<section>
<section id="slide-org8e6b492">
<h2 id="org8e6b492">Summary</h2>
<p>
By
</p>

<p>
<b>using Ansible for infrastructure management</b>
</p>

<p>
you
</p>

<p>
<b>remove unknown state in your deployment process</b>
</p>
</section>
</section>
<section>
<section id="slide-orga43d25e">
<h2 id="orga43d25e">The Problem</h2>
<ul>
<li>"How did we set up this computer?"</li>

</ul>
<p>
hint : <i>SVDs don't count</i>
</p>
<ul class="fragment roll-in">
<li>"Quick, rebuild this machine!" (from scratch)</li>

</ul>
<ul class="fragment roll-in">
<li>"Client says we actually need 5 more!"</li>

</ul>
<ul class="fragment roll-in">
<li>"How do we orchestrate our services?" (Â© FDECO 2017)</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgfe1ee00">
<h2 id="orgfe1ee00">Ansible</h2>
<ul>
<li>Automation tool</li>
<li>"Shell scripts over SSH"</li>
<li>Declare expected state as YAML</li>

</ul>


</section>
</section>
<section>
<section id="slide-orgbc0283c">
<h2 id="orgbc0283c">Sample usecases</h2>
<ul>
<li>Provisioning</li>
<li>Deployment</li>
<li>Orchestration</li>

</ul>


</section>
<section id="slide-orgb1726b6">
<h3 id="orgb1726b6">Provisioning</h3>
<blockquote nil>
<p>
I got my Ubuntu 14.04 &#x2026; now what?
</p>
</blockquote>
<p>
Clean-room rebuild (servers)
</p>

</section>
<section id="slide-orge66bb60">
<h3 id="orge66bb60">Deployment</h3>
<p>
(re)Apply everything needed to get your application running
</p>


<div class="figure">
<p><img src="jenkins_logo.png" alt="jenkins_logo.png" />
</p>
</div>
</section>
<section id="slide-orga3ce543">
<h3 id="orga3ce543">Orchestration</h3>
<p>
From simple package upgrade to zero-downtime db migration
</p>


</section>
</section>
<section>
<section id="slide-org98a1421">
<h2 id="org98a1421">Why Ansible?</h2>
<div class="outline-text-2" id="text-org98a1421">
</div></section>
<section id="slide-orgbb86bda">
<h3 id="orgbb86bda">Simple</h3>
<ul>
<li>readable : YAML to describe state</li>
<li>small footprint (SSH + Python + Sudo)</li>
<li>smaller learning curve than others</li>

</ul>
</section>
<section id="slide-org35ec7a3">
<h3 id="org35ec7a3">Cross-platform</h3>
<ul>
<li>Agentless : use at home or in production</li>
<li>SSH-only : use in VM, bare metal, docker&#x2026;</li>
<li>support for Windows, Linux flavours, AWS, Azure &#x2026;</li>

</ul>
</section>
<section id="slide-orgcd2d8f5">
<h3 id="orgcd2d8f5">Extensible</h3>
<ul>
<li>Modules are tiny python wrappers over bash</li>
<li>Ansible galaxy ~ docker Hub</li>
<li>Can still use bash if needed</li>

</ul>

</section>
</section>
<section>
<section id="slide-orge696d54">
<h2 id="orge696d54">Core ansible concepts</h2>
<div class="outline-text-2" id="text-orge696d54">
</div></section>
<section id="slide-orgc4c8ac3">
<h3 id="orgc4c8ac3">Inventory: Who's who</h3>
<p>
List of computers reachable over SSH, optionally grouped
</p>
<div class="org-src-container">

<pre  class="src src-conf"><span style="color: #73d216;"># </span><span style="color: #73d216;">my laptop</span>
sbl-jbd-laptop1.seebyte.com

[<span style="color: #8cc4ff;">fdeco</span>]
hecate.seebyte.com

<span style="color: #73d216;"># </span><span style="color: #73d216;">database range</span>
[<span style="color: #8cc4ff;">databases</span>]
db-[a:f].example.com

[<span style="color: #8cc4ff;">neptune-vms</span>]
<span style="color: #fcaf3e;">lanoit  ansible_host</span>=192.168.44.173
<span style="color: #fcaf3e;">falken  ansible_host</span>=192.168.44.174
<span style="color: #fcaf3e;">nappy   ansible_host</span>=192.168.44.176

<span style="color: #73d216;"># </span><span style="color: #73d216;">Group of Groups via `:children`</span>
[<span style="color: #8cc4ff;">servers:children</span>]
fdeco
databases
</pre>
</div>
</section>
<section id="slide-orgbf521d9">
<h3 id="orgbf521d9">Ad-hoc commands</h3>
<div class="org-src-container">

<pre  class="src src-shell"><span style="color: #73d216;"># </span><span style="color: #73d216;">ping all machines in inventory</span>
ansible all -m ping
</pre>
</div>

<div class="org-src-container">

<pre  class="fragment roll-in"><span style="color: #73d216;"># </span><span style="color: #73d216;">restart SSH daemon on all staging servers</span>
ansible staging -m service -a <span style="color: #e9b96e;">"name=sshd state=restarted"</span>
</pre>
</div>

<div class="org-src-container">

<pre  class="fragment roll-in"><span style="color: #73d216;"># </span><span style="color: #73d216;">reboot all webservers, 10 forks at a time</span>
ansible webservers -a <span style="color: #e9b96e;">"/sbin/reboot"</span> -f 10
</pre>
</div>

</section>
<section id="slide-org8129a06">
<h3 id="org8129a06">Playbook: Command[]</h3>
<div class="org-src-container">

<pre  class="src src-yaml">- <span style="color: #fcaf3e;">hosts</span>: webservers
  <span style="color: #fcaf3e;">remote_user</span>: root
  <span style="color: #fcaf3e;">vars</span>:
    <span style="color: #fcaf3e;">http_port</span>: 80
    <span style="color: #fcaf3e;">max_clients</span>: 200

  <span style="color: #fcaf3e;">tasks</span>:
  - <span style="color: #fcaf3e;">name</span>: ensure apache is at the latest version
    <span style="color: #fcaf3e;">apt-get</span>:
      <span style="color: #fcaf3e;">name</span>: apache2
      <span style="color: #fcaf3e;">state</span>: latest
  - <span style="color: #fcaf3e;">name</span>: write the apache config file
    <span style="color: #fcaf3e;">template</span>:
      <span style="color: #fcaf3e;">src</span>: /srv/httpd.j2
      <span style="color: #fcaf3e;">dest</span>: /etc/httpd.conf
    <span style="color: #fcaf3e;">notify</span>:
    - restart apache
  <span style="color: #fcaf3e;">handlers</span>:
    - <span style="color: #fcaf3e;">name</span>: restart apache
      <span style="color: #fcaf3e;">service</span>: name=httpd state=restarted
</pre>
</div>
</section>
</section>
<section>
<section id="slide-orga3ef360">
<h2 id="orga3ef360">Demo time!</h2>

</section>
</section>
<section>
<section id="slide-orgc86eead">
<h2 id="orgc86eead">Some ansible modules</h2>
<ul>
<li>apt-get</li>
<li>git</li>
<li>template</li>
<li>copy</li>
<li>user</li>
<li>docker pull</li>
<li>docker-compose</li>

</ul>

</section>
</section>
<section>
<section id="slide-org3e2abfb">
<h2 id="org3e2abfb">Ansible vs others</h2>
<ul>
<li>Does not need central server</li>
<li>Does not need agents</li>
<li>Easier to learn
<ul>
<li>no Ruby/Groovy</li>
<li>no master/minion</li>
<li>no manifest/certs</li>

</ul></li>

</ul>
</section>
</section>
<section>
<section id="slide-org960e65e">
<h2 id="org960e65e">Extra-fun features</h2>
<ul>
<li>Idempotence</li>
<li>Template validation</li>
<li>Pull-mode</li>
<li>Dry-run</li>
<li>Facts gathering</li>
<li>Variable prompting</li>
<li>Fine-grained targetting (by tags, regexp, set-math &#x2026;)</li>
<li>encryption of sensitive data (ansible-vault)</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgfe45265">
<h2 id="orgfe45265">Conclusion</h2>
<p>
Code tooling is mature:
</p>
<ul>
<li>version control</li>
<li>code review</li>
<li>continuous delivery</li>

</ul>

<p>
Why not have infrastructure as code?
</p>


</section>
</section>
<section>
<section id="slide-org5459a98">
<h2 id="org5459a98">Q&amp;A</h2>

</section>
</section>
<section>
<section id="slide-orgb272148">
<h2 id="orgb272148">But the shell is better!</h2>
<blockquote  class="fragment roll-in">
<p>
But, Jb, what's the point of using YAML when a shell script is more expressive!?
</p>
</blockquote>
<p class="fragment roll-in">
Ansible is a tool to describe state, not a way to get there.
</p>

<p class="fragment roll-in">
Try keeping up to date a script (or scripts) that provisions multiple
machines based on which group they're in (webserver, monitoring,
staging vs prod etc).
</p>

<p class="fragment roll-in">
Try running the provisioning script twice.
</p>

<p class="fragment roll-in">
Try adding templating options for files, having conditionals and
variable passing from the orchestrator &#x2026;
</p>

</section>
<section id="slide-org12529a5">
<h3 id="org12529a5">Summary : bash vs ansible</h3>
<p>
Which method:
</p>
<ul class="fragment roll-in">
<li>can be run multiple times safely with confidence?</li>

</ul>
<ul class="fragment roll-in">
<li>can easily be run against multiple servers?</li>

</ul>
<ul class="fragment roll-in">
<li>actually verifies (tests) your server for correctness?</li>

</ul>
<ul class="fragment roll-in">
<li>can target certain servers easily (web, db, etc)?</li>

</ul>
<ul class="fragment roll-in">
<li>is most likely to end up in source control?</li>

</ul>
<ul class="fragment roll-in">
<li>supports easily templating your configuration files?</li>

</ul>
<ul class="fragment roll-in">
<li>will grow to easily support your whole stack?</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgdbf2a26">
<h2 id="orgdbf2a26">But Chef is more professional!</h2>
<blockquote  class="fragment roll-in">
<p>
But, Jb, all the big companies use &lt;Chef, Puppet, Salt&gt;, not Ansible!
Don't you want to be cool like them?
</p>
</blockquote>

<ul class="fragment roll-in">
<li>Ansible:
<ul>
<li>10 minutes = 1 playbook doing apt-get</li>
<li>1 hour = entire VM provisioning done</li>
<li>more time = more features delivered</li>

</ul></li>

</ul>

<ul class="fragment roll-in">
<li>Chef, Puppet:
<ul>
<li>10 minutes = eyes hurt</li>
<li>20 minutes = "how do we start doing this then?"</li>

</ul></li>

</ul>

</section>
<section id="slide-orga4d1547">
<h3 id="orga4d1547">Ansible scaling</h3>
<ul>
<li>"push via SSH" doesn't scale? go Pull-mode</li>
<li>&lt;&lt; 100 machines not worth industrial-scale tools</li>
<li>learning curve that much worse</li>

</ul>

</section>
</section>
<section>
<section id="slide-orgb795ac7">
<h2 id="orgb795ac7">Jinja2</h2>
<div class="org-src-container">

<pre  class="src src-yaml">- <span style="color: #fcaf3e;">hosts</span>: loc
  <span style="color: #fcaf3e;">vars</span>:
    <span style="color: #fcaf3e;">temp_var</span>: <span style="color: #e9b96e;">'Replacement value for variable'</span>
    <span style="color: #fcaf3e;">temp_var2</span>: <span style="color: #e9b96e;">'Variable2'</span>
  <span style="color: #fcaf3e;">tasks</span>:
    - <span style="color: #fcaf3e;">name</span>: Ansible Template Example
      <span style="color: #fcaf3e;">template</span>:
        <span style="color: #fcaf3e;">src</span>: templates_example.j2
        <span style="color: #fcaf3e;">dest</span>: /home/someguy/output.txt
</pre>
</div>

<div class="org-src-container">

<pre  class="src src-jinja2"><span style="color: #8cc4ff;">{{</span> <span style="color: #fcaf3e;">ansible_managed</span><span style="color: #8cc4ff;">}}</span>
This <span style="color: #e090d7;">is</span> a template file. The below line will be replaced by the variable temp_var.
<span style="color: #8cc4ff;">{{</span> <span style="color: #fcaf3e;">temp_var</span> <span style="color: #8cc4ff;">}}</span>
<span style="color: #8cc4ff;">{{</span> <span style="color: #fcaf3e;">temp_var2</span> <span style="color: #8cc4ff;">}}</span>
<span style="color: #8cc4ff;">{{</span> <span style="color: #fcaf3e;">ansible_os_family</span><span style="color: #8cc4ff;">}}</span>
</pre>
</div>

<p>
Result:
</p>
<pre  class="example">
Ansible Managed
This is a template file. The below line will be replaced by the variable temp_var.
Replacement value for variable
Variable2
Ubuntu
</pre>
</section>
</section>
</div>
</div>
<script src="http://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/head.min.js"></script>
<script src="http://cdn.jsdelivr.net/reveal.js/3.0.0/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
 { src: 'http://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }]
});
</script>
</body>
</html>
